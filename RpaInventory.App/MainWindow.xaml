<Window x:Class="RpaInventory.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:inv="clr-namespace:RpaInventory.App.Inventory.Items"
        xmlns:vm="clr-namespace:RpaInventory.App.Inventory.ViewModels"
        xmlns:wvm="clr-namespace:RpaInventory.App.Workspace.ViewModels"
        xmlns:wse="clr-namespace:RpaInventory.App.WorkspaceExplorer"
        mc:Ignorable="d"
        Title="Inventário RPA"
        Height="720"
        Width="1200"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        Background="#FF1B1B1B"
        PreviewKeyDown="MainWindow_PreviewKeyDown"
        PreviewKeyUp="MainWindow_PreviewKeyUp">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />

        <Geometry x:Key="WorkspaceFolderIconGeometry">M2,6 H9 L11,8 H22 V20 H2 Z M2,6 V4 H8 L10,6 Z</Geometry>
        <Geometry x:Key="WorkspaceFileIconGeometry">M6,2 H16 L20,6 V22 H6 Z M16,2 V6 H20</Geometry>

        <Style x:Key="SectionButtonStyle" TargetType="{x:Type Button}">
            <Setter Property="Width" Value="44" />
            <Setter Property="Height" Value="44" />
            <Setter Property="Margin" Value="0,0,3,0" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Background" Value="#FF8B8B8B" />
            <Setter Property="BorderBrush" Value="#FF3C3C3C" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="ToolTipService.ShowDuration" Value="60000" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="2">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF9A9A9A" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#FFAFAFAF" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                    <Setter Property="Background" Value="#FFDADADA" />
                    <Setter Property="BorderBrush" Value="#FF1C1C1C" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SlotBorderStyle" TargetType="{x:Type Border}">
            <Setter Property="Width" Value="44" />
            <Setter Property="Height" Value="44" />
            <Setter Property="Margin" Value="2" />
            <Setter Property="Background" Value="#FF8E8E8E" />
            <Setter Property="BorderBrush" Value="#FF2D2D2D" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="CornerRadius" Value="1" />
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="Slot_PreviewMouseLeftButtonDown" />
            <EventSetter Event="MouseMove" Handler="Slot_MouseMove" />
            <EventSetter Event="MouseEnter" Handler="Slot_MouseEnter" />
            <EventSetter Event="MouseLeave" Handler="Slot_MouseLeave" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFA4A4A4" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="BackpackSlotBorderStyle" TargetType="{x:Type Border}" BasedOn="{StaticResource SlotBorderStyle}">
            <Setter Property="Background" Value="#FF7E7E7E" />
        </Style>

        <DataTemplate x:Key="IconTemplate">
            <Grid Width="28" Height="28">
                <Viewbox x:Name="IconBox" Stretch="Uniform">
                    <Path Data="{Binding Icon}" Fill="#FF202020" Stretch="Uniform" />
                </Viewbox>
                <TextBlock x:Name="IconText"
                           Visibility="Collapsed"
                           Text="{Binding IconText}"
                           Foreground="#FF202020"
                           FontWeight="Bold"
                           FontSize="12"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center" />
            </Grid>
            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding Icon}" Value="{x:Null}">
                    <Setter TargetName="IconBox" Property="Visibility" Value="Collapsed" />
                    <Setter TargetName="IconText" Property="Visibility" Value="Visible" />
                </DataTrigger>
            </DataTemplate.Triggers>
        </DataTemplate>

        <DataTemplate x:Key="WorkspaceItemTemplate" DataType="{x:Type inv:IInventoryItem}">
            <Border Background="#FF303030"
                    BorderBrush="#FF5A5A5A"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="8"
                    Margin="6">
                <DockPanel LastChildFill="True">
                    <Border DockPanel.Dock="Left"
                            Width="44"
                            Height="44"
                            Background="#FF8E8E8E"
                            BorderBrush="#FF2D2D2D"
                            BorderThickness="2"
                            CornerRadius="2"
                            Margin="0,0,10,0">
                        <ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource IconTemplate}" />
                    </Border>
                    <StackPanel>
                        <TextBlock Text="{Binding DisplayName}"
                                   Foreground="#FFF0F0F0"
                                   FontWeight="SemiBold"
                                   FontSize="14" />
                        <TextBlock Text="{Binding Description}"
                                   Foreground="#FFBEBEBE"
                                   FontSize="12"
                                   TextWrapping="Wrap"
                                   MaxWidth="280"
                                   Margin="0,2,0,0" />
                    </StackPanel>
                </DockPanel>
            </Border>
        </DataTemplate>

        <DataTemplate DataType="{x:Type vm:SlotViewModel}">
            <Border Style="{StaticResource SlotBorderStyle}"
                    Tag="InventorySlot"
                    ToolTipService.IsEnabled="{Binding HasItem}">
                <Border.ToolTip>
                    <StackPanel MaxWidth="260">
                        <TextBlock Text="{Binding Item.DisplayName}" FontWeight="Bold" />
                        <TextBlock Text="{Binding Item.Description}"
                                   TextWrapping="Wrap"
                                   Margin="0,4,0,0" />
                    </StackPanel>
                </Border.ToolTip>
                <ContentPresenter Content="{Binding Item}" ContentTemplate="{StaticResource IconTemplate}" />
            </Border>
        </DataTemplate>

        <DataTemplate DataType="{x:Type vm:SectionViewModel}">
            <Button Style="{StaticResource SectionButtonStyle}"
                    ToolTip="{Binding DisplayName}"
                    Command="{Binding DataContext.SelectSectionCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                    CommandParameter="{Binding}">
                <ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource IconTemplate}" />
            </Button>
        </DataTemplate>

        <DataTemplate DataType="{x:Type wvm:WorkspaceShapeViewModel}">
            <Grid Width="{Binding Width}"
                  Height="{Binding Height}"
                  Background="Transparent"
                  MouseLeftButtonDown="WorkspaceShape_MouseLeftButtonDown"
                  MouseMove="WorkspaceShape_MouseMove"
                  MouseLeftButtonUp="WorkspaceShape_MouseLeftButtonUp"
                  MouseRightButtonDown="WorkspaceShape_MouseRightButtonDown">
                <Rectangle x:Name="RectShape"
                           RadiusX="2"
                           RadiusY="2"
                           Fill="#FF7A7A7A"
                           Stroke="#FF2D2D2D"
                           StrokeThickness="2" />
                <Polygon x:Name="DiamondShape"
                         Points="{Binding DiamondPoints}"
                         Fill="#FF7A7A7A"
                         Stroke="#FF2D2D2D"
                         StrokeThickness="2"
                          Visibility="Collapsed" />
                <Ellipse x:Name="StartShape"
                         Fill="#FF1DBA3A"
                         Stroke="#FF0B4A16"
                         StrokeThickness="2"
                         Visibility="Collapsed" />
            </Grid>

            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding Kind}" Value="{x:Static wvm:WorkspaceShapeKind.Diamond}">
                    <Setter TargetName="RectShape" Property="Visibility" Value="Collapsed" />
                    <Setter TargetName="DiamondShape" Property="Visibility" Value="Visible" />
                    <Setter TargetName="StartShape" Property="Visibility" Value="Collapsed" />
                </DataTrigger>

                <DataTrigger Binding="{Binding Kind}" Value="{x:Static wvm:WorkspaceShapeKind.LogicDecision}">
                    <Setter TargetName="RectShape" Property="Visibility" Value="Collapsed" />
                    <Setter TargetName="DiamondShape" Property="Visibility" Value="Visible" />
                    <Setter TargetName="StartShape" Property="Visibility" Value="Collapsed" />
                </DataTrigger>

                <DataTrigger Binding="{Binding Kind}" Value="{x:Static wvm:WorkspaceShapeKind.Start}">
                    <Setter TargetName="RectShape" Property="Visibility" Value="Collapsed" />
                    <Setter TargetName="DiamondShape" Property="Visibility" Value="Collapsed" />
                    <Setter TargetName="StartShape" Property="Visibility" Value="Visible" />
                </DataTrigger>

                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                    <Setter TargetName="RectShape" Property="Stroke" Value="#FF4CFF4C" />
                    <Setter TargetName="DiamondShape" Property="Stroke" Value="#FF4CFF4C" />
                    <Setter TargetName="StartShape" Property="Stroke" Value="#FF4CFF4C" />
                    <Setter TargetName="RectShape" Property="StrokeThickness" Value="3" />
                    <Setter TargetName="DiamondShape" Property="StrokeThickness" Value="3" />
                    <Setter TargetName="StartShape" Property="StrokeThickness" Value="3" />
                </DataTrigger>
            </DataTemplate.Triggers>
        </DataTemplate>

        <DataTemplate DataType="{x:Type wvm:WorkspaceImageViewModel}">
            <Grid Width="{Binding Width}"
                  Height="{Binding Height}"
                  Background="Transparent"
                  MouseLeftButtonDown="WorkspaceImage_MouseLeftButtonDown"
                  MouseMove="WorkspaceImage_MouseMove"
                  MouseLeftButtonUp="WorkspaceImage_MouseLeftButtonUp"
                  MouseRightButtonDown="WorkspaceImage_MouseRightButtonDown">
                <Border x:Name="ImageBorder"
                        Background="#FF6A6A6A"
                        BorderBrush="#FF2D2D2D"
                        BorderThickness="2"
                        CornerRadius="4">
                    <Grid>
                        <Image x:Name="ImageContent"
                               Source="{Binding Source}"
                               Stretch="UniformToFill" />
                        <TextBlock x:Name="ImagePlaceholder"
                                   Text="IMG"
                                   Foreground="#FF202020"
                                   FontWeight="Bold"
                                   FontSize="24"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Visibility="Collapsed" />
                    </Grid>
                </Border>
            </Grid>

            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding Source}" Value="{x:Null}">
                    <Setter TargetName="ImageContent" Property="Visibility" Value="Collapsed" />
                    <Setter TargetName="ImagePlaceholder" Property="Visibility" Value="Visible" />
                </DataTrigger>

                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                    <Setter TargetName="ImageBorder" Property="BorderBrush" Value="#FF4CFF4C" />
                    <Setter TargetName="ImageBorder" Property="BorderThickness" Value="3" />
                </DataTrigger>
            </DataTemplate.Triggers>
        </DataTemplate>

        <DataTemplate DataType="{x:Type wvm:LineViewModel}">
            <Grid>
                <Canvas>
                    <Line X1="{Binding P1.X}"
                          Y1="{Binding P1.Y}"
                          X2="{Binding P2.X}"
                          Y2="{Binding P2.Y}"
                          StrokeThickness="3"
                          StrokeStartLineCap="Round"
                          StrokeEndLineCap="Round"
                          MouseLeftButtonDown="WorkspaceLine_MouseLeftButtonDown"
                          MouseMove="WorkspaceLine_MouseMove"
                          MouseLeftButtonUp="WorkspaceLine_MouseLeftButtonUp">
                        <Line.Style>
                            <Style TargetType="Line">
                                <Setter Property="Stroke" Value="#FFEAEAEA" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                        <Setter Property="Stroke" Value="#FFFFE16A" />
                                        <Setter Property="StrokeThickness" Value="4" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Line.Style>
                    </Line>

                    <Grid Canvas.Left="{Binding MarkerX}"
                          Canvas.Top="{Binding MarkerY}"
                          Visibility="{Binding HasLogicMarker, Converter={StaticResource BoolToVisibility}}"
                          IsHitTestVisible="False">
                        <Grid.RenderTransform>
                            <TranslateTransform X="-9" Y="-9" />
                        </Grid.RenderTransform>
                        <Ellipse Width="18"
                                 Height="18"
                                 Fill="{Binding MarkerFill}"
                                 Stroke="#FF202020"
                                 StrokeThickness="1" />
                        <TextBlock Text="{Binding MarkerText}"
                                   Foreground="#FFF6F6F6"
                                   FontWeight="Bold"
                                   FontSize="12"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center" />
                    </Grid>

                    <Ellipse Width="10"
                             Height="10"
                             Fill="#FFCC0000"
                             Stroke="#FF120000"
                             StrokeThickness="1"
                             Tag="P1"
                             Canvas.Left="{Binding P1.X}"
                             Canvas.Top="{Binding P1.Y}"
                             MouseLeftButtonDown="Endpoint_MouseLeftButtonDown"
                             MouseMove="Endpoint_MouseMove"
                             MouseLeftButtonUp="Endpoint_MouseLeftButtonUp">
                        <Ellipse.RenderTransform>
                            <TranslateTransform X="-5" Y="-5" />
                        </Ellipse.RenderTransform>
                    </Ellipse>

                    <Ellipse Width="10"
                             Height="10"
                             Fill="#FFCC0000"
                             Stroke="#FF120000"
                             StrokeThickness="1"
                             Tag="P2"
                             Canvas.Left="{Binding P2.X}"
                             Canvas.Top="{Binding P2.Y}"
                             MouseLeftButtonDown="Endpoint_MouseLeftButtonDown"
                             MouseMove="Endpoint_MouseMove"
                             MouseLeftButtonUp="Endpoint_MouseLeftButtonUp">
                        <Ellipse.RenderTransform>
                            <TranslateTransform X="-5" Y="-5" />
                        </Ellipse.RenderTransform>
                    </Ellipse>
                </Canvas>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type wvm:WorkspaceBallViewModel}">
            <Ellipse Width="4"
                     Height="4"
                     Fill="#FFFFE16A"
                     Stroke="#FF202020"
                     StrokeThickness="1">
                <Ellipse.RenderTransform>
                    <TranslateTransform X="-2" Y="-2" />
                </Ellipse.RenderTransform>
            </Ellipse>
        </DataTemplate>

        <HierarchicalDataTemplate DataType="{x:Type wse:WorkspaceTreeNodeViewModel}"
                                  ItemsSource="{Binding Children}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Path x:Name="WorkspaceNodeIcon"
                      Grid.Column="0"
                      Width="16"
                      Height="16"
                      Margin="0,0,6,0"
                      Fill="#FFBEBEBE"
                      Data="{StaticResource WorkspaceFileIconGeometry}" />

                <TextBlock Grid.Column="1"
                           Text="{Binding Name}"
                           Foreground="#FFF6F6F6"
                           VerticalAlignment="Center" />

                <Grid.ContextMenu>
                    <ContextMenu DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
                        <MenuItem Header="Criar arquivo" Command="{Binding CreateFileCommand}">
                            <MenuItem.Style>
                                <Style TargetType="{x:Type MenuItem}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Kind}" Value="{x:Static wse:WorkspaceNodeKind.Project}">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Kind}" Value="{x:Static wse:WorkspaceNodeKind.Folder}">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </MenuItem.Style>
                        </MenuItem>

                        <MenuItem Header="Criar pasta" Command="{Binding CreateFolderCommand}">
                            <MenuItem.Style>
                                <Style TargetType="{x:Type MenuItem}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Kind}" Value="{x:Static wse:WorkspaceNodeKind.Project}">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Kind}" Value="{x:Static wse:WorkspaceNodeKind.Folder}">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </MenuItem.Style>
                        </MenuItem>

                        <Separator>
                            <Separator.Style>
                                <Style TargetType="{x:Type Separator}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Kind}" Value="{x:Static wse:WorkspaceNodeKind.Project}">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Kind}" Value="{x:Static wse:WorkspaceNodeKind.Folder}">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Separator.Style>
                        </Separator>

                        <MenuItem Header="Renomear" Command="{Binding RenameCommand}" />
                        <MenuItem Header="Deletar" Command="{Binding DeleteCommand}" />
                    </ContextMenu>
                </Grid.ContextMenu>
            </Grid>

            <HierarchicalDataTemplate.Triggers>
                <DataTrigger Binding="{Binding Kind}" Value="{x:Static wse:WorkspaceNodeKind.Project}">
                    <Setter TargetName="WorkspaceNodeIcon" Property="Data" Value="{StaticResource WorkspaceFolderIconGeometry}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Kind}" Value="{x:Static wse:WorkspaceNodeKind.Folder}">
                    <Setter TargetName="WorkspaceNodeIcon" Property="Data" Value="{StaticResource WorkspaceFolderIconGeometry}" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Kind}" Value="{x:Static wse:WorkspaceNodeKind.File}">
                    <Setter TargetName="WorkspaceNodeIcon" Property="Data" Value="{StaticResource WorkspaceFileIconGeometry}" />
                </DataTrigger>
            </HierarchicalDataTemplate.Triggers>
        </HierarchicalDataTemplate>

        <DataTemplate DataType="{x:Type wse:WorkspaceSearchResultViewModel}">
            <TextBlock TextWrapping="Wrap" Foreground="#FFEAEAEA">
                <Run Text="&lt;" />
                <Run Text="{Binding FileName}" Foreground="#FFBEBEBE" FontWeight="SemiBold" />
                <Run Text="&gt; - " />
                <Run Text="{Binding Before}" />
                <Run Text="{Binding Match}" Foreground="#FFFFE16A" FontWeight="Bold" />
                <Run Text="{Binding After}" />
            </TextBlock>
        </DataTemplate>
    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        
        <Menu Grid.Row="0" Background="#FF2B2B2B" Foreground="#FFF6F6F6" Margin="0,0,0,5">
            <MenuItem Header="Configurações" Click="SettingsMenuItem_Click" />
        </Menu>
        
        <Grid Grid.Row="1">
        <Button x:Name="StartButton"
                Content="START"
                Width="140"
                Height="40"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Margin="0,8,0,0"
                Background="#FF1DBA3A"
                Foreground="#FFF0F0F0"
                FontWeight="Bold"
                BorderBrush="#FF0B4A16"
                BorderThickness="2"
                Panel.ZIndex="1000"
                Click="StartButton_Click" />

        <Border Background="#FF2A2A2A"
                BorderBrush="#FF4A4A4A"
                BorderThickness="1"
                CornerRadius="8"
                Padding="0">
            <Grid>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Canvas x:Name="WorkspaceCanvas"
                            Grid.Row="0"
                            Grid.Column="0"
                            Background="#FF1F1F1F"
                            Focusable="True"
                            ClipToBounds="True"
                            AllowDrop="True"
                            DragEnter="Workspace_DragEnter"
                            DragOver="Workspace_DragOver"
                            Drop="Workspace_Drop"
                            PreviewMouseWheel="WorkspaceCanvas_PreviewMouseWheel"
                            MouseLeftButtonDown="WorkspaceCanvas_MouseLeftButtonDown"
                            MouseMove="WorkspaceCanvas_MouseMove"
                            MouseLeftButtonUp="WorkspaceCanvas_MouseLeftButtonUp">
                        <Canvas x:Name="WorldCanvas"
                                Width="{Binding ActualWidth, ElementName=WorkspaceCanvas}"
                                Height="{Binding ActualHeight, ElementName=WorkspaceCanvas}">
                            <Canvas.RenderTransform>
                                <MatrixTransform x:Name="WorldTransform" />
                            </Canvas.RenderTransform>

                            <ItemsControl ItemsSource="{Binding Workspace.Shapes}"
                                          Canvas.ZIndex="0">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <Canvas />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="ContentPresenter">
                                        <Setter Property="Canvas.Left" Value="{Binding X}" />
                                        <Setter Property="Canvas.Top" Value="{Binding Y}" />
                                    </Style>
                                </ItemsControl.ItemContainerStyle>
                            </ItemsControl>

                            <ItemsControl ItemsSource="{Binding Workspace.Images}"
                                          Canvas.ZIndex="1">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <Canvas />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="ContentPresenter">
                                        <Setter Property="Canvas.Left" Value="{Binding X}" />
                                        <Setter Property="Canvas.Top" Value="{Binding Y}" />
                                    </Style>
                                </ItemsControl.ItemContainerStyle>
                            </ItemsControl>

                            <ItemsControl ItemsSource="{Binding Workspace.Lines}"
                                          Canvas.ZIndex="10"
                                          Width="{Binding ActualWidth, ElementName=WorkspaceCanvas}"
                                          Height="{Binding ActualHeight, ElementName=WorkspaceCanvas}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <Canvas />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="ContentPresenter">
                                        <Setter Property="Canvas.Left" Value="0" />
                                        <Setter Property="Canvas.Top" Value="0" />
                                        <Setter Property="Width"
                                                Value="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ItemsControl}}" />
                                        <Setter Property="Height"
                                                Value="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=ItemsControl}}" />
                                    </Style>
                                </ItemsControl.ItemContainerStyle>
                            </ItemsControl>

                            <ItemsControl ItemsSource="{Binding Workspace.Balls}"
                                          Canvas.ZIndex="15">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <Canvas />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="ContentPresenter">
                                        <Setter Property="Canvas.Left" Value="{Binding X}" />
                                        <Setter Property="Canvas.Top" Value="{Binding Y}" />
                                    </Style>
                                </ItemsControl.ItemContainerStyle>
                            </ItemsControl>

                            <Line X1="{Binding Workspace.DraftLine.X1}"
                                  Y1="{Binding Workspace.DraftLine.Y1}"
                                  X2="{Binding Workspace.DraftLine.X2}"
                                  Y2="{Binding Workspace.DraftLine.Y2}"
                                  Stroke="#FF80D0FF"
                                  StrokeThickness="2"
                                  StrokeDashArray="3,2"
                                  Canvas.ZIndex="20"
                                  Visibility="{Binding Workspace.DraftLine.IsActive, Converter={StaticResource BoolToVisibility}}" />

                            <Grid Canvas.ZIndex="21"
                                  Canvas.Left="{Binding Workspace.DraftLine.MarkerX}"
                                  Canvas.Top="{Binding Workspace.DraftLine.MarkerY}"
                                  IsHitTestVisible="False">
                                <Grid.RenderTransform>
                                    <TranslateTransform X="-9" Y="-9" />
                                </Grid.RenderTransform>
                                <Grid.Style>
                                    <Style TargetType="Grid">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding Workspace.DraftLine.IsActive}" Value="True" />
                                                    <Condition Binding="{Binding Workspace.DraftLine.HasLogicMarker}" Value="True" />
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Visibility" Value="Visible" />
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>
                                <Ellipse Width="18"
                                         Height="18"
                                         Fill="{Binding Workspace.DraftLine.MarkerFill}"
                                         Stroke="#FF202020"
                                         StrokeThickness="1" />
                                <TextBlock Text="{Binding Workspace.DraftLine.MarkerText}"
                                           Foreground="#FFF6F6F6"
                                           FontWeight="Bold"
                                           FontSize="12"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                            </Grid>

                            <Rectangle x:Name="SelectionRectangle"
                                       Canvas.ZIndex="25"
                                       Stroke="#FF4CA6FF"
                                       StrokeThickness="1"
                                       Fill="#334CA6FF"
                                       Visibility="Collapsed" />

                            <Ellipse Width="14"
                                     Height="14"
                                     Fill="#00000000"
                                     Stroke="#FF4CFF4C"
                                     StrokeThickness="2"
                                     Canvas.ZIndex="30"
                                     Canvas.Left="{Binding Workspace.SnapPreview.X}"
                                     Canvas.Top="{Binding Workspace.SnapPreview.Y}"
                                     Visibility="{Binding Workspace.SnapPreview.IsVisible, Converter={StaticResource BoolToVisibility}}">
                                <Ellipse.RenderTransform>
                                    <TranslateTransform X="-7" Y="-7" />
                                </Ellipse.RenderTransform>
                            </Ellipse>
                        </Canvas>
                    </Canvas>

                    <ScrollBar x:Name="WorkspaceHScrollBar"
                               Grid.Row="1"
                               Grid.Column="0"
                               Orientation="Horizontal"
                               Height="14"
                               Margin="0"
                               Visibility="Collapsed"
                               ValueChanged="WorkspaceHScrollBar_ValueChanged" />

                    <ScrollBar x:Name="WorkspaceVScrollBar"
                               Grid.Row="0"
                               Grid.Column="1"
                               Orientation="Vertical"
                               Width="14"
                               Margin="0"
                               Visibility="Collapsed"
                               ValueChanged="WorkspaceVScrollBar_ValueChanged" />

                    <Rectangle Grid.Row="1" Grid.Column="1" Width="14" Height="14" Fill="Transparent" />
                </Grid>

        <Border x:Name="WorkspaceHelpBorder"
                Visibility="Collapsed"
                        Background="#CC1B1B1B"
                        BorderBrush="#FF4A4A4A"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="10"
                        Margin="12"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        Width="360">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Área de trabalho"
                                       Foreground="#FFEAEAEA"
                                       FontSize="14"
                                       FontWeight="SemiBold" />
                            <TextBlock Text="  (E abre/fecha inventário | SHIFT cria linha | ALT descola ponto)"
                                       Foreground="#FFBEBEBE"
                                       FontSize="12"
                                       Margin="6,2,0,0" />
                        </StackPanel>

                        <ScrollViewer Grid.Row="1"
                                      VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled"
                                      Margin="0,8,0,0">
                            <ItemsControl ItemsSource="{Binding WorkspaceItems}"
                                          ItemTemplate="{StaticResource WorkspaceItemTemplate}" />
                        </ScrollViewer>
                    </Grid>
                </Border>

                <Border x:Name="WorkspaceExplorerBorder"
                        Background="#CC1B1B1B"
                        BorderBrush="#FF4A4A4A"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="10"
                        Margin="12"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Top"
                        Width="360"
                        Height="620"
                        Panel.ZIndex="2000">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <DockPanel Grid.Row="0" LastChildFill="False">
                            <TextBlock Text="Workspace"
                                       Foreground="#FFEAEAEA"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       DockPanel.Dock="Left" />

                            <Button x:Name="WorkspaceNewButton"
                                    DockPanel.Dock="Right"
                                    Content="Novo"
                                    Width="70"
                                    Height="26"
                                    Margin="10,0,0,0"
                                    Background="#FF7A7A7A"
                                    BorderBrush="#FF2D2D2D"
                                    BorderThickness="1"
                                    Foreground="#FF202020"
                                    Click="WorkspaceNewButton_Click" />
                        </DockPanel>

                        <Grid Grid.Row="1" Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="110" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBox x:Name="WorkspaceSearchTextBox"
                                     Grid.Column="0"
                                     Height="28"
                                     Background="#FF2A2A2A"
                                     BorderBrush="#FF4A4A4A"
                                     BorderThickness="1"
                                     Foreground="#FFF6F6F6"
                                     Padding="6,4"
                                     VerticalContentAlignment="Center"
                                     Text="{Binding WorkspaceExplorer.SearchText, UpdateSourceTrigger=PropertyChanged}">
                                <TextBox.InputBindings>
                                    <KeyBinding Key="Enter" Command="{Binding WorkspaceExplorer.SearchCommand}" />
                                </TextBox.InputBindings>
                            </TextBox>

                            <ComboBox Grid.Column="1"
                                      Height="28"
                                      Margin="8,0,0,0"
                                      Background="#FF2A2A2A"
                                      BorderBrush="#FF4A4A4A"
                                      BorderThickness="1"
                                      Foreground="#FFF6F6F6"
                                      ItemsSource="{Binding WorkspaceExplorer.SearchFilters}"
                                      DisplayMemberPath="DisplayName"
                                      SelectedItem="{Binding WorkspaceExplorer.SelectedSearchFilter}" />

                            <Button Grid.Column="2"
                                    Content="Buscar"
                                    Width="64"
                                    Height="28"
                                    Margin="8,0,0,0"
                                    Background="#FF7A7A7A"
                                    BorderBrush="#FF2D2D2D"
                                    BorderThickness="1"
                                    Foreground="#FF202020"
                                    Command="{Binding WorkspaceExplorer.SearchCommand}" />

                            <Button Grid.Column="3"
                                    Content="X"
                                    Width="28"
                                    Height="28"
                                    Margin="6,0,0,0"
                                    Background="#FF3A3A3A"
                                    BorderBrush="#FF2D2D2D"
                                    BorderThickness="1"
                                    Foreground="#FFF6F6F6"
                                    Command="{Binding WorkspaceExplorer.ClearSearchCommand}" />
                        </Grid>

                        <Grid Grid.Row="2" Margin="0,10,0,0">
                            <TreeView x:Name="WorkspaceTreeView"
                                      ItemsSource="{Binding WorkspaceExplorer.Projects}"
                                      AllowDrop="True"
                                      PreviewMouseLeftButtonDown="WorkspaceExplorerTree_PreviewMouseLeftButtonDown"
                                      MouseMove="WorkspaceExplorerTree_MouseMove"
                                      DragOver="WorkspaceExplorerTree_DragOver"
                                      Drop="WorkspaceExplorerTree_Drop">
                                <TreeView.Style>
                                    <Style TargetType="{x:Type TreeView}">
                                        <Setter Property="Visibility" Value="Visible" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding WorkspaceExplorer.IsSearchMode}" Value="True">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TreeView.Style>
                                <TreeView.ItemContainerStyle>
                                    <Style TargetType="{x:Type TreeViewItem}">
                                        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                                        <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                                        <Setter Property="Foreground" Value="#FFF6F6F6" />
                                        <Setter Property="Background" Value="Transparent" />
                                        <Setter Property="Padding" Value="2" />
                                    </Style>
                                </TreeView.ItemContainerStyle>
                                <TreeView.ContextMenu>
                                    <ContextMenu DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
                                        <MenuItem Header="Criar projeto"
                                                  Command="{Binding WorkspaceExplorer.CreateProjectCommand}" />
                                    </ContextMenu>
                                </TreeView.ContextMenu>
                            </TreeView>

                            <ListBox x:Name="WorkspaceSearchResultsList"
                                     ItemsSource="{Binding WorkspaceExplorer.SearchResults}"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     SelectionChanged="WorkspaceSearchResultsList_SelectionChanged">
                                <ListBox.Style>
                                    <Style TargetType="{x:Type ListBox}">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding WorkspaceExplorer.IsSearchMode}" Value="True">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ListBox.Style>
                            </ListBox>

                            <TextBlock Text="Nenhum resultado"
                                       Foreground="#FFBEBEBE"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center">
                                <TextBlock.Style>
                                    <Style TargetType="{x:Type TextBlock}">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding WorkspaceExplorer.IsSearchMode}" Value="True" />
                                                    <Condition Binding="{Binding WorkspaceExplorer.HasSearchResults}" Value="False" />
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Visibility" Value="Visible" />
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>

                            <Button Content="Criar projeto"
                                    Width="140"
                                    Height="34"
                                    Background="#FF1DBA3A"
                                    BorderBrush="#FF0B4A16"
                                    BorderThickness="2"
                                    Foreground="#FFF0F0F0"
                                    FontWeight="Bold"
                                    Command="{Binding WorkspaceExplorer.CreateProjectCommand}"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                                <Button.Style>
                                    <Style TargetType="{x:Type Button}">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding WorkspaceExplorer.HasProjects}" Value="False" />
                                                    <Condition Binding="{Binding WorkspaceExplorer.IsSearchMode}" Value="False" />
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Visibility" Value="Visible" />
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <Border Background="#FFB7B7B7"
                BorderBrush="#FF4A4A4A"
                BorderThickness="2"
                CornerRadius="8"
                Padding="12"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Visibility="{Binding IsInventoryOpen, Converter={StaticResource BoolToVisibility}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ItemsControl Grid.Row="0"
                              ItemsSource="{Binding TopSections}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <Border Grid.Row="1"
                        Margin="0,8"
                        Background="#FFA0A0A0"
                        BorderBrush="#FF4A4A4A"
                        BorderThickness="2"
                        CornerRadius="6"
                        Padding="6"
                        HorizontalAlignment="Center">
                    <ScrollViewer VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  MaxHeight="200">
                        <ItemsControl ItemsSource="{Binding Slots}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <UniformGrid Columns="7" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>

                <ItemsControl Grid.Row="2"
                              ItemsSource="{Binding BottomSections}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </Grid>
        </Border>

        <Border Background="#FFB7B7B7"
                BorderBrush="#FF4A4A4A"
                BorderThickness="2"
                CornerRadius="10"
                Padding="10"
                HorizontalAlignment="Center"
                VerticalAlignment="Bottom"
                Margin="0,0,0,12">
            <ItemsControl ItemsSource="{Binding BackpackSlots}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Columns="7" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type vm:SlotViewModel}">
                        <Border Style="{StaticResource BackpackSlotBorderStyle}"
                                Tag="BackpackSlot"
                                AllowDrop="True"
                                DragEnter="BackpackSlot_DragEnter"
                                DragOver="BackpackSlot_DragOver"
                                Drop="BackpackSlot_Drop"
                                ToolTipService.IsEnabled="{Binding HasItem}">
                            <Border.ToolTip>
                                <StackPanel MaxWidth="260">
                                    <TextBlock Text="{Binding Item.DisplayName}" FontWeight="Bold" />
                                    <TextBlock Text="{Binding Item.Description}"
                                               TextWrapping="Wrap"
                                               Margin="0,4,0,0" />
                                </StackPanel>
                            </Border.ToolTip>
                            <ContentPresenter Content="{Binding Item}" ContentTemplate="{StaticResource IconTemplate}" />
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Border>
        </Grid>
    </Grid>
</Window>
